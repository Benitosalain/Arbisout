{"ast":null,"code":"import Datastore from 'nedb-promises';\nimport bcrypt from 'bcryptjs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\n// Resolve __dirname in ES module style\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Make sure users.db is always loaded from the project root\nconst dbPath = path.resolve(__dirname, '../../users.db'); // Adjust if needed\n\nconst usersDb = Datastore.create({\n  filename: dbPath,\n  autoload: true\n});\nconst saltRounds = 10;\n\n// Ensure a default admin user exists\nasync function ensureDefaultAdmin() {\n  const users = await usersDb.find({});\n  if (users.length === 0) {\n    const hashedPassword = await bcrypt.hash('123456', saltRounds);\n    await usersDb.insert({\n      username: 'admin',\n      password: hashedPassword,\n      role: 'admin'\n    });\n    console.log('✅ Default admin user created: admin / 123456');\n  }\n}\nensureDefaultAdmin();\nexport async function getAllUsers() {\n  try {\n    const users = await usersDb.find({});\n    return users;\n  } catch {\n    return [];\n  }\n}\nexport async function findUser(username, password) {\n  try {\n    const user = await usersDb.findOne({\n      username\n    });\n    if (user && user.password) {\n      const passwordMatch = await bcrypt.compare(password, user.password);\n      return passwordMatch ? user : null;\n    }\n    return null;\n  } catch (error) {\n    console.error('Error finding user:', error);\n    return null;\n  }\n}\nexport async function addUser(username, password, role = 'user') {\n  try {\n    const existing = await usersDb.findOne({\n      username\n    });\n    if (existing) {\n      return {\n        success: false,\n        error: \"User exists\"\n      };\n    }\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\n    const newUser = {\n      username,\n      password: hashedPassword,\n      role\n    };\n    await usersDb.insert(newUser);\n    return {\n      success: true,\n      user: newUser\n    };\n  } catch (error) {\n    console.error('Error adding user:', error);\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n}\nexport async function deleteUser(username) {\n  try {\n    const result = await usersDb.remove({\n      username\n    }, {});\n    if (result === 0) {\n      return {\n        success: false,\n        error: \"User not found\"\n      };\n    }\n    return {\n      success: true\n    };\n  } catch (error) {\n    console.error(\"Error deleting user:\", error);\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n}\nexport default usersDb;","map":{"version":3,"names":["Datastore","bcrypt","path","fileURLToPath","__filename","import","meta","url","__dirname","dirname","dbPath","resolve","usersDb","create","filename","autoload","saltRounds","ensureDefaultAdmin","users","find","length","hashedPassword","hash","insert","username","password","role","console","log","getAllUsers","findUser","user","findOne","passwordMatch","compare","error","addUser","existing","success","newUser","message","deleteUser","result","remove"],"sources":["C:/Users/benit/Music/arbisout/src/db/users.js"],"sourcesContent":["import Datastore from 'nedb-promises';\r\nimport bcrypt from 'bcryptjs';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\n// Resolve __dirname in ES module style\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Make sure users.db is always loaded from the project root\r\nconst dbPath = path.resolve(__dirname, '../../users.db'); // Adjust if needed\r\n\r\nconst usersDb = Datastore.create({ filename: dbPath, autoload: true });\r\nconst saltRounds = 10;\r\n\r\n// Ensure a default admin user exists\r\nasync function ensureDefaultAdmin() {\r\n  const users = await usersDb.find({});\r\n  if (users.length === 0) {\r\n    const hashedPassword = await bcrypt.hash('123456', saltRounds);\r\n    await usersDb.insert({ username: 'admin', password: hashedPassword, role: 'admin' });\r\n    console.log('✅ Default admin user created: admin / 123456');\r\n  }\r\n}\r\nensureDefaultAdmin();\r\n\r\nexport async function getAllUsers() {\r\n  try {\r\n    const users = await usersDb.find({});\r\n    return users;\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function findUser(username, password) {\r\n  try {\r\n    const user = await usersDb.findOne({ username });\r\n    if (user && user.password) {\r\n      const passwordMatch = await bcrypt.compare(password, user.password);\r\n      return passwordMatch ? user : null;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('Error finding user:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function addUser(username, password, role = 'user') {\r\n  try {\r\n    const existing = await usersDb.findOne({ username });\r\n    if (existing) {\r\n      return { success: false, error: \"User exists\" };\r\n    }\r\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\r\n    const newUser = { username, password: hashedPassword, role };\r\n    await usersDb.insert(newUser);\r\n    return { success: true, user: newUser };\r\n  } catch (error) {\r\n    console.error('Error adding user:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\nexport async function deleteUser(username) {\r\n  try {\r\n    const result = await usersDb.remove({ username }, {});\r\n    if (result === 0) {\r\n      return { success: false, error: \"User not found\" };\r\n    }\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Error deleting user:\", error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}\r\n\r\nexport default usersDb;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}