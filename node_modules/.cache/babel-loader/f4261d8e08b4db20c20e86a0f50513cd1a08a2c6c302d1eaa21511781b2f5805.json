{"ast":null,"code":"/**\n * Way data is stored for this database\n *\n * This version is the browser version and uses [localforage]{@link https://github.com/localForage/localForage} which chooses the best option depending on user browser (IndexedDB then WebSQL then localStorage).\n * @module storageBrowser\n * @see module:storage\n * @see module:storageReactNative\n * @private\n */\n\nconst localforage = require('localforage');\n\n// Configure localforage to display NeDB name for now. Would be a good idea to let user use his own app name\nconst store = localforage.createInstance({\n  name: 'NeDB',\n  storeName: 'nedbdata'\n});\n\n/**\n * Returns Promise<true> if file exists.\n *\n * @param {string} file\n * @return {Promise<boolean>}\n * @async\n * @alias module:storageBrowser.existsAsync\n */\nconst existsAsync = async file => {\n  try {\n    const value = await store.getItem(file);\n    if (value !== null) return true; // Even if value is undefined, localforage returns null\n    return false;\n  } catch (error) {\n    console.warn('NeDB - storage.browser - existsAsync:', error);\n    return false;\n  }\n};\n\n/**\n * Moves the item from one path to another.\n * @param {string} oldPath\n * @param {string} newPath\n * @return {Promise<void>}\n * @alias module:storageBrowser.renameAsync\n * @async\n */\nconst renameAsync = async (oldPath, newPath) => {\n  try {\n    const value = await store.getItem(oldPath);\n    if (value === null) await store.removeItem(newPath);else {\n      await store.setItem(newPath, value);\n      await store.removeItem(oldPath);\n    }\n  } catch (err) {\n    console.warn('NeDB - storage.browser - renameAsync:', err);\n    console.warn('An error happened while renaming, skip');\n  }\n};\n\n/**\n * Saves the item at given path.\n * @param {string} file\n * @param {string} data\n * @param {object} [options]\n * @return {Promise<void>}\n * @alias module:storageBrowser.writeFileAsync\n * @async\n */\nconst writeFileAsync = async (file, data, options) => {\n  // Options do not matter in browser setup\n  try {\n    await store.setItem(file, data);\n  } catch (error) {\n    console.warn('NeDB - storage.browser - writeFileAsync:', error);\n    console.warn('An error happened while writing, skip');\n  }\n};\n\n/**\n * Append to the item at given path.\n * @function\n * @param {string} filename\n * @param {string} toAppend\n * @param {object} [options]\n * @return {Promise<void>}\n * @alias module:storageBrowser.appendFileAsync\n * @async\n */\nconst appendFileAsync = async (filename, toAppend, options) => {\n  // Options do not matter in browser setup\n  try {\n    const contents = (await store.getItem(filename)) || '';\n    await store.setItem(filename, contents + toAppend);\n  } catch (error) {\n    console.warn('NeDB - storage.browser - appendFileAsync:', error);\n    console.warn('An error happened appending to file writing, skip');\n  }\n};\n\n/**\n * Read data at given path.\n * @function\n * @param {string} filename\n * @param {object} [options]\n * @return {Promise<Buffer>}\n * @alias module:storageBrowser.readFileAsync\n * @async\n */\nconst readFileAsync = async (filename, options) => {\n  try {\n    return (await store.getItem(filename)) || '';\n  } catch (error) {\n    console.warn('NeDB - storage.browser - readFileAsync:', error);\n    console.warn('An error happened while reading, skip');\n    return '';\n  }\n};\n\n/**\n * Async version of {@link module:storageBrowser.unlink}.\n * @function\n * @param {string} filename\n * @return {Promise<void>}\n * @async\n * @alias module:storageBrowser.unlink\n */\nconst unlinkAsync = async filename => {\n  try {\n    await store.removeItem(filename);\n  } catch (error) {\n    console.warn('NeDB - storage.browser - unlinkAsync:', error);\n    console.warn('An error happened while unlinking, skip');\n  }\n};\n\n/**\n * Shim for {@link module:storage.mkdirAsync}, nothing to do, no directories will be used on the browser.\n * @function\n * @param {string} path\n * @param {object} [options]\n * @return {Promise<void|string>}\n * @alias module:storageBrowser.mkdirAsync\n * @async\n */\nconst mkdirAsync = (path, options) => Promise.resolve();\n\n/**\n * Shim for {@link module:storage.ensureParentDirectoryExistsAsync}, nothing to do, no directories will be used on the browser.\n * @function\n * @param {string} file\n * @param {number} [mode]\n * @return {Promise<void|string>}\n * @alias module:storageBrowser.ensureParentDirectoryExistsAsync\n * @async\n */\nconst ensureParentDirectoryExistsAsync = async (file, mode) => Promise.resolve();\n\n/**\n * Shim for {@link module:storage.ensureDatafileIntegrityAsync}, nothing to do, no data corruption possible in the browser.\n * @param {string} filename\n * @return {Promise<void>}\n * @alias module:storageBrowser.ensureDatafileIntegrityAsync\n */\nconst ensureDatafileIntegrityAsync = filename => Promise.resolve();\n\n/**\n * Fully write or rewrite the datafile, immune to crashes during the write operation (data will not be lost)\n * * @param {string} filename\n * @param {string[]} lines\n * @return {Promise<void>}\n * @alias module:storageBrowser.crashSafeWriteFileLinesAsync\n */\nconst crashSafeWriteFileLinesAsync = async (filename, lines) => {\n  lines.push(''); // Add final new line\n  await writeFileAsync(filename, lines.join('\\n'));\n};\n\n// Interface\nmodule.exports.existsAsync = existsAsync;\nmodule.exports.renameAsync = renameAsync;\nmodule.exports.writeFileAsync = writeFileAsync;\nmodule.exports.crashSafeWriteFileLinesAsync = crashSafeWriteFileLinesAsync;\nmodule.exports.appendFileAsync = appendFileAsync;\nmodule.exports.readFileAsync = readFileAsync;\nmodule.exports.unlinkAsync = unlinkAsync;\nmodule.exports.mkdirAsync = mkdirAsync;\nmodule.exports.ensureDatafileIntegrityAsync = ensureDatafileIntegrityAsync;\nmodule.exports.ensureParentDirectoryExistsAsync = ensureParentDirectoryExistsAsync;","map":{"version":3,"names":["localforage","require","store","createInstance","name","storeName","existsAsync","file","value","getItem","error","console","warn","renameAsync","oldPath","newPath","removeItem","setItem","err","writeFileAsync","data","options","appendFileAsync","filename","toAppend","contents","readFileAsync","unlinkAsync","mkdirAsync","path","Promise","resolve","ensureParentDirectoryExistsAsync","mode","ensureDatafileIntegrityAsync","crashSafeWriteFileLinesAsync","lines","push","join","module","exports"],"sources":["C:/Users/benit/Music/arbisout/node_modules/@seald-io/nedb/browser-version/lib/storage.browser.js"],"sourcesContent":["/**\n * Way data is stored for this database\n *\n * This version is the browser version and uses [localforage]{@link https://github.com/localForage/localForage} which chooses the best option depending on user browser (IndexedDB then WebSQL then localStorage).\n * @module storageBrowser\n * @see module:storage\n * @see module:storageReactNative\n * @private\n */\n\nconst localforage = require('localforage')\n\n// Configure localforage to display NeDB name for now. Would be a good idea to let user use his own app name\nconst store = localforage.createInstance({\n  name: 'NeDB',\n  storeName: 'nedbdata'\n})\n\n/**\n * Returns Promise<true> if file exists.\n *\n * @param {string} file\n * @return {Promise<boolean>}\n * @async\n * @alias module:storageBrowser.existsAsync\n */\nconst existsAsync = async file => {\n  try {\n    const value = await store.getItem(file)\n    if (value !== null) return true // Even if value is undefined, localforage returns null\n    return false\n  } catch (error) {\n    console.warn('NeDB - storage.browser - existsAsync:', error)\n    return false\n  }\n}\n\n/**\n * Moves the item from one path to another.\n * @param {string} oldPath\n * @param {string} newPath\n * @return {Promise<void>}\n * @alias module:storageBrowser.renameAsync\n * @async\n */\nconst renameAsync = async (oldPath, newPath) => {\n  try {\n    const value = await store.getItem(oldPath)\n    if (value === null) await store.removeItem(newPath)\n    else {\n      await store.setItem(newPath, value)\n      await store.removeItem(oldPath)\n    }\n  } catch (err) {\n    console.warn('NeDB - storage.browser - renameAsync:', err)\n    console.warn('An error happened while renaming, skip')\n  }\n}\n\n/**\n * Saves the item at given path.\n * @param {string} file\n * @param {string} data\n * @param {object} [options]\n * @return {Promise<void>}\n * @alias module:storageBrowser.writeFileAsync\n * @async\n */\nconst writeFileAsync = async (file, data, options) => {\n  // Options do not matter in browser setup\n  try {\n    await store.setItem(file, data)\n  } catch (error) {\n    console.warn('NeDB - storage.browser - writeFileAsync:', error)\n    console.warn('An error happened while writing, skip')\n  }\n}\n\n/**\n * Append to the item at given path.\n * @function\n * @param {string} filename\n * @param {string} toAppend\n * @param {object} [options]\n * @return {Promise<void>}\n * @alias module:storageBrowser.appendFileAsync\n * @async\n */\nconst appendFileAsync = async (filename, toAppend, options) => {\n  // Options do not matter in browser setup\n  try {\n    const contents = (await store.getItem(filename)) || ''\n    await store.setItem(filename, contents + toAppend)\n  } catch (error) {\n    console.warn('NeDB - storage.browser - appendFileAsync:', error)\n    console.warn('An error happened appending to file writing, skip')\n  }\n}\n\n/**\n * Read data at given path.\n * @function\n * @param {string} filename\n * @param {object} [options]\n * @return {Promise<Buffer>}\n * @alias module:storageBrowser.readFileAsync\n * @async\n */\nconst readFileAsync = async (filename, options) => {\n  try {\n    return (await store.getItem(filename)) || ''\n  } catch (error) {\n    console.warn('NeDB - storage.browser - readFileAsync:', error)\n    console.warn('An error happened while reading, skip')\n    return ''\n  }\n}\n\n/**\n * Async version of {@link module:storageBrowser.unlink}.\n * @function\n * @param {string} filename\n * @return {Promise<void>}\n * @async\n * @alias module:storageBrowser.unlink\n */\nconst unlinkAsync = async filename => {\n  try {\n    await store.removeItem(filename)\n  } catch (error) {\n    console.warn('NeDB - storage.browser - unlinkAsync:', error)\n    console.warn('An error happened while unlinking, skip')\n  }\n}\n\n/**\n * Shim for {@link module:storage.mkdirAsync}, nothing to do, no directories will be used on the browser.\n * @function\n * @param {string} path\n * @param {object} [options]\n * @return {Promise<void|string>}\n * @alias module:storageBrowser.mkdirAsync\n * @async\n */\nconst mkdirAsync = (path, options) => Promise.resolve()\n\n/**\n * Shim for {@link module:storage.ensureParentDirectoryExistsAsync}, nothing to do, no directories will be used on the browser.\n * @function\n * @param {string} file\n * @param {number} [mode]\n * @return {Promise<void|string>}\n * @alias module:storageBrowser.ensureParentDirectoryExistsAsync\n * @async\n */\nconst ensureParentDirectoryExistsAsync = async (file, mode) => Promise.resolve()\n\n/**\n * Shim for {@link module:storage.ensureDatafileIntegrityAsync}, nothing to do, no data corruption possible in the browser.\n * @param {string} filename\n * @return {Promise<void>}\n * @alias module:storageBrowser.ensureDatafileIntegrityAsync\n */\nconst ensureDatafileIntegrityAsync = (filename) => Promise.resolve()\n\n/**\n * Fully write or rewrite the datafile, immune to crashes during the write operation (data will not be lost)\n * * @param {string} filename\n * @param {string[]} lines\n * @return {Promise<void>}\n * @alias module:storageBrowser.crashSafeWriteFileLinesAsync\n */\nconst crashSafeWriteFileLinesAsync = async (filename, lines) => {\n  lines.push('') // Add final new line\n  await writeFileAsync(filename, lines.join('\\n'))\n}\n\n// Interface\nmodule.exports.existsAsync = existsAsync\n\nmodule.exports.renameAsync = renameAsync\n\nmodule.exports.writeFileAsync = writeFileAsync\n\nmodule.exports.crashSafeWriteFileLinesAsync = crashSafeWriteFileLinesAsync\n\nmodule.exports.appendFileAsync = appendFileAsync\n\nmodule.exports.readFileAsync = readFileAsync\n\nmodule.exports.unlinkAsync = unlinkAsync\n\nmodule.exports.mkdirAsync = mkdirAsync\n\nmodule.exports.ensureDatafileIntegrityAsync = ensureDatafileIntegrityAsync\n\nmodule.exports.ensureParentDirectoryExistsAsync = ensureParentDirectoryExistsAsync\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}