{"ast":null,"code":"/**\n * Responsible for sequentially executing actions on the database\n * @private\n */\nclass Waterfall {\n  /**\n   * Instantiate a new Waterfall.\n   */\n  constructor() {\n    /**\n     * This is the internal Promise object which resolves when all the tasks of the `Waterfall` are done.\n     *\n     * It will change any time `this.waterfall` is called.\n     *\n     * @type {Promise}\n     */\n    this.guardian = Promise.resolve();\n  }\n\n  /**\n   *\n   * @param {AsyncFunction} func\n   * @return {AsyncFunction}\n   */\n  waterfall(func) {\n    return (...args) => {\n      this.guardian = this.guardian.then(() => {\n        return func(...args).then(result => ({\n          error: false,\n          result\n        }), result => ({\n          error: true,\n          result\n        }));\n      });\n      return this.guardian.then(({\n        error,\n        result\n      }) => {\n        if (error) return Promise.reject(result);else return Promise.resolve(result);\n      });\n    };\n  }\n\n  /**\n   * Shorthand for chaining a promise to the Waterfall\n   * @param {Promise} promise\n   * @return {Promise}\n   */\n  chain(promise) {\n    return this.waterfall(() => promise)();\n  }\n}\nmodule.exports = Waterfall;","map":{"version":3,"names":["Waterfall","constructor","guardian","Promise","resolve","waterfall","func","args","then","result","error","reject","chain","promise","module","exports"],"sources":["C:/Users/benit/Music/arbisout/node_modules/@seald-io/nedb/lib/waterfall.js"],"sourcesContent":["/**\n * Responsible for sequentially executing actions on the database\n * @private\n */\nclass Waterfall {\n  /**\n   * Instantiate a new Waterfall.\n   */\n  constructor () {\n    /**\n     * This is the internal Promise object which resolves when all the tasks of the `Waterfall` are done.\n     *\n     * It will change any time `this.waterfall` is called.\n     *\n     * @type {Promise}\n     */\n    this.guardian = Promise.resolve()\n  }\n\n  /**\n   *\n   * @param {AsyncFunction} func\n   * @return {AsyncFunction}\n   */\n  waterfall (func) {\n    return (...args) => {\n      this.guardian = this.guardian.then(() => {\n        return func(...args)\n          .then(result => ({ error: false, result }), result => ({ error: true, result }))\n      })\n      return this.guardian.then(({ error, result }) => {\n        if (error) return Promise.reject(result)\n        else return Promise.resolve(result)\n      })\n    }\n  }\n\n  /**\n   * Shorthand for chaining a promise to the Waterfall\n   * @param {Promise} promise\n   * @return {Promise}\n   */\n  chain (promise) {\n    return this.waterfall(() => promise)()\n  }\n}\n\nmodule.exports = Waterfall\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,MAAMA,SAAS,CAAC;EACd;AACF;AACA;EACEC,WAAWA,CAAA,EAAI;IACb;AACJ;AACA;AACA;AACA;AACA;AACA;IACI,IAAI,CAACC,QAAQ,GAAGC,OAAO,CAACC,OAAO,CAAC,CAAC;EACnC;;EAEA;AACF;AACA;AACA;AACA;EACEC,SAASA,CAAEC,IAAI,EAAE;IACf,OAAO,CAAC,GAAGC,IAAI,KAAK;MAClB,IAAI,CAACL,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACM,IAAI,CAAC,MAAM;QACvC,OAAOF,IAAI,CAAC,GAAGC,IAAI,CAAC,CACjBC,IAAI,CAACC,MAAM,KAAK;UAAEC,KAAK,EAAE,KAAK;UAAED;QAAO,CAAC,CAAC,EAAEA,MAAM,KAAK;UAAEC,KAAK,EAAE,IAAI;UAAED;QAAO,CAAC,CAAC,CAAC;MACpF,CAAC,CAAC;MACF,OAAO,IAAI,CAACP,QAAQ,CAACM,IAAI,CAAC,CAAC;QAAEE,KAAK;QAAED;MAAO,CAAC,KAAK;QAC/C,IAAIC,KAAK,EAAE,OAAOP,OAAO,CAACQ,MAAM,CAACF,MAAM,CAAC,MACnC,OAAON,OAAO,CAACC,OAAO,CAACK,MAAM,CAAC;MACrC,CAAC,CAAC;IACJ,CAAC;EACH;;EAEA;AACF;AACA;AACA;AACA;EACEG,KAAKA,CAAEC,OAAO,EAAE;IACd,OAAO,IAAI,CAACR,SAAS,CAAC,MAAMQ,OAAO,CAAC,CAAC,CAAC;EACxC;AACF;AAEAC,MAAM,CAACC,OAAO,GAAGf,SAAS","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}