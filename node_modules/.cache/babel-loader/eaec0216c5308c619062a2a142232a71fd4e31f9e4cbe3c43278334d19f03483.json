{"ast":null,"code":"import Datastore from 'nedb-promises';\nimport bcrypt from 'bcryptjs'; // You'll need to install this: npm install bcryptjs\n\nconst usersDb = Datastore.create({\n  filename: 'users.db',\n  autoload: true\n});\nconst saltRounds = 10; // For bcrypt hashing\n\n// Ensure a default admin user exists with a hashed password\nasync function ensureDefaultAdmin() {\n  const users = await usersDb.find({});\n  if (users.length === 0) {\n    const hashedPassword = await bcrypt.hash('123456', saltRounds);\n    await usersDb.insert({\n      username: 'admin',\n      password: hashedPassword,\n      role: 'admin'\n    });\n    console.log('✅ Default admin user created: admin / 123456 (hashed)');\n  }\n}\nensureDefaultAdmin();\nexport async function getAllUsers() {\n  try {\n    const users = await usersDb.find({});\n    return users;\n  } catch {\n    return [];\n  }\n}\nexport async function findUser(username, password) {\n  try {\n    const user = await usersDb.findOne({\n      username\n    });\n    if (user && user.password) {\n      const passwordMatch = await bcrypt.compare(password, user.password);\n      return passwordMatch ? user : null;\n    }\n    return null;\n  } catch (error) {\n    console.error('Error finding user:', error);\n    return null;\n  }\n}\n\n// Example function to add a new user with a hashed password\nexport async function addUser(username, password, role = 'user') {\n  try {\n    const existing = await usersDb.findOne({\n      username\n    });\n    if (existing) {\n      return {\n        success: false,\n        error: \"User exists\"\n      };\n    }\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\n    const newUser = {\n      username,\n      password: hashedPassword,\n      role\n    };\n    await usersDb.insert(newUser);\n    return {\n      success: true,\n      user: newUser\n    };\n  } catch (error) {\n    console.error('Error adding user:', error);\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n}\nexport default usersDb;","map":{"version":3,"names":["Datastore","bcrypt","usersDb","create","filename","autoload","saltRounds","ensureDefaultAdmin","users","find","length","hashedPassword","hash","insert","username","password","role","console","log","getAllUsers","findUser","user","findOne","passwordMatch","compare","error","addUser","existing","success","newUser","message"],"sources":["C:/Users/benit/Music/arbisout/src/db/users.js"],"sourcesContent":["import Datastore from 'nedb-promises';\r\nimport bcrypt from 'bcryptjs'; // You'll need to install this: npm install bcryptjs\r\n\r\nconst usersDb = Datastore.create({ filename: 'users.db', autoload: true });\r\nconst saltRounds = 10; // For bcrypt hashing\r\n\r\n// Ensure a default admin user exists with a hashed password\r\nasync function ensureDefaultAdmin() {\r\n    const users = await usersDb.find({});\r\n    if (users.length === 0) {\r\n        const hashedPassword = await bcrypt.hash('123456', saltRounds);\r\n        await usersDb.insert({ username: 'admin', password: hashedPassword, role: 'admin' });\r\n        console.log('✅ Default admin user created: admin / 123456 (hashed)');\r\n    }\r\n}\r\nensureDefaultAdmin();\r\n\r\nexport async function getAllUsers() {\r\n    try {\r\n        const users = await usersDb.find({});\r\n        return users;\r\n    } catch {\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function findUser(username, password) {\r\n    try {\r\n        const user = await usersDb.findOne({ username });\r\n        if (user && user.password) {\r\n            const passwordMatch = await bcrypt.compare(password, user.password);\r\n            return passwordMatch ? user : null;\r\n        }\r\n        return null;\r\n    } catch (error) {\r\n        console.error('Error finding user:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Example function to add a new user with a hashed password\r\nexport async function addUser(username, password, role = 'user') {\r\n    try {\r\n        const existing = await usersDb.findOne({ username });\r\n        if (existing) {\r\n            return { success: false, error: \"User exists\" };\r\n        }\r\n        const hashedPassword = await bcrypt.hash(password, saltRounds);\r\n        const newUser = { username, password: hashedPassword, role };\r\n        await usersDb.insert(newUser);\r\n        return { success: true, user: newUser };\r\n    } catch (error) {\r\n        console.error('Error adding user:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\nexport default usersDb;"],"mappings":"AAAA,OAAOA,SAAS,MAAM,eAAe;AACrC,OAAOC,MAAM,MAAM,UAAU,CAAC,CAAC;;AAE/B,MAAMC,OAAO,GAAGF,SAAS,CAACG,MAAM,CAAC;EAAEC,QAAQ,EAAE,UAAU;EAAEC,QAAQ,EAAE;AAAK,CAAC,CAAC;AAC1E,MAAMC,UAAU,GAAG,EAAE,CAAC,CAAC;;AAEvB;AACA,eAAeC,kBAAkBA,CAAA,EAAG;EAChC,MAAMC,KAAK,GAAG,MAAMN,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC,CAAC;EACpC,IAAID,KAAK,CAACE,MAAM,KAAK,CAAC,EAAE;IACpB,MAAMC,cAAc,GAAG,MAAMV,MAAM,CAACW,IAAI,CAAC,QAAQ,EAAEN,UAAU,CAAC;IAC9D,MAAMJ,OAAO,CAACW,MAAM,CAAC;MAAEC,QAAQ,EAAE,OAAO;MAAEC,QAAQ,EAAEJ,cAAc;MAAEK,IAAI,EAAE;IAAQ,CAAC,CAAC;IACpFC,OAAO,CAACC,GAAG,CAAC,uDAAuD,CAAC;EACxE;AACJ;AACAX,kBAAkB,CAAC,CAAC;AAEpB,OAAO,eAAeY,WAAWA,CAAA,EAAG;EAChC,IAAI;IACA,MAAMX,KAAK,GAAG,MAAMN,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC,CAAC;IACpC,OAAOD,KAAK;EAChB,CAAC,CAAC,MAAM;IACJ,OAAO,EAAE;EACb;AACJ;AAEA,OAAO,eAAeY,QAAQA,CAACN,QAAQ,EAAEC,QAAQ,EAAE;EAC/C,IAAI;IACA,MAAMM,IAAI,GAAG,MAAMnB,OAAO,CAACoB,OAAO,CAAC;MAAER;IAAS,CAAC,CAAC;IAChD,IAAIO,IAAI,IAAIA,IAAI,CAACN,QAAQ,EAAE;MACvB,MAAMQ,aAAa,GAAG,MAAMtB,MAAM,CAACuB,OAAO,CAACT,QAAQ,EAAEM,IAAI,CAACN,QAAQ,CAAC;MACnE,OAAOQ,aAAa,GAAGF,IAAI,GAAG,IAAI;IACtC;IACA,OAAO,IAAI;EACf,CAAC,CAAC,OAAOI,KAAK,EAAE;IACZR,OAAO,CAACQ,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;IAC3C,OAAO,IAAI;EACf;AACJ;;AAEA;AACA,OAAO,eAAeC,OAAOA,CAACZ,QAAQ,EAAEC,QAAQ,EAAEC,IAAI,GAAG,MAAM,EAAE;EAC7D,IAAI;IACA,MAAMW,QAAQ,GAAG,MAAMzB,OAAO,CAACoB,OAAO,CAAC;MAAER;IAAS,CAAC,CAAC;IACpD,IAAIa,QAAQ,EAAE;MACV,OAAO;QAAEC,OAAO,EAAE,KAAK;QAAEH,KAAK,EAAE;MAAc,CAAC;IACnD;IACA,MAAMd,cAAc,GAAG,MAAMV,MAAM,CAACW,IAAI,CAACG,QAAQ,EAAET,UAAU,CAAC;IAC9D,MAAMuB,OAAO,GAAG;MAAEf,QAAQ;MAAEC,QAAQ,EAAEJ,cAAc;MAAEK;IAAK,CAAC;IAC5D,MAAMd,OAAO,CAACW,MAAM,CAACgB,OAAO,CAAC;IAC7B,OAAO;MAAED,OAAO,EAAE,IAAI;MAAEP,IAAI,EAAEQ;IAAQ,CAAC;EAC3C,CAAC,CAAC,OAAOJ,KAAK,EAAE;IACZR,OAAO,CAACQ,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;IAC1C,OAAO;MAAEG,OAAO,EAAE,KAAK;MAAEH,KAAK,EAAEA,KAAK,CAACK;IAAQ,CAAC;EACnD;AACJ;AAEA,eAAe5B,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}